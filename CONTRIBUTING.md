# Contributing

ありがとうございます！このリポジトリへの貢献方法についてまとめます。

## 事前チェック（必須）
- 開発前に最新の `main` ブランチを pull してください。
- 変更は feature ブランチを切って作業し、PR を作成してください。

## テストと実行確認（必須）
- プッシュ前に必ず以下を実行して下さい。

```bash
# ワークスペースルートを PYTHONPATH に追加してテストを実行
PYTHONPATH=. pytest
# 実行確認
python app.py
```

## コミットメッセージ
- 変更内容が分かる短いメッセージを使用してください。例: `Fix: handle None in foo`。

## Pull Request
- PR には変更の要約と動作確認手順（テストコマンド含む）を必ず記載してください。

---
小さな変更でもテストが通ることを確認してから PR を投げてください。

## DDD (Domain-Driven Design) への段階的移行について

このリポジトリは段階的に DDD 構成へ移行しています。現在のトップレベル構成の目安:

- `src/domain/` — ドメインモデルとドメインサービス（ビジネスロジック）
- `src/application/` — ユースケース（アプリケーション層のオーケストレーション、ハンドラ）
- `src/infrastructure/` — 外部 API へのアダプター（LINE API 等）
- 既存のモジュールは互換性を壊さないために shim を置いています。

移行の基本ルール:

1. 小さいコミットで進める（1つの責務だけ移動する）。
2. 既存の外部インターフェース（関数名・引数）を変えないようにする。変更する場合は shim を用意して互換性を保つ。
3. 移動後は必ずテストを実行して動作を確認する。
4. 外部 API 呼び出しは直接ドメインに書かない。ドメインはポート（インターフェース）を定義し、インフラ側でアダプタを実装する。

具体的な次の作業（推奨順）:

1. `src/domain/` にドメインロジックを移動し、結果を shim でラップする（完了済みの作業あり）。
2. `src/application/handlers.py` を作り、Flask のルーティングとイベントハンドラを移す。
3. `src/infrastructure/` に外部 API のアダプターを実装して、テスト用のモックを差し替えられるようにする。
4. CI を更新してレイヤー別のユニットテストを回す。

何か作業を始めるときは Issue を作って作業計画を共有してください。

